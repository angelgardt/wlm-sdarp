# Предобработка данных {#r-tidy}

{{< include other/_symbols.qmd >}}

```{r opts, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE, error=FALSE}
knitr::opts_chunk$set(echo=TRUE, eval=TRUE, message=TRUE, warning=TRUE, error=FALSE)
```

:::{.intro}
Вступление
:::

## Концепция Tidy Data {#r-tidy-concept}

## Семейство пакетов `tidyverse` {#r-tidy-tidyverse}


```{r}
library(tidyverse)
```

### Импорт данных {#r-tidy-import}

```{r exmpl-data-create, echo=FALSE, eval=FALSE, message=FALSE}
tibble(
  id = paste0("r", 1:6),
  V1 = c("Abc", "Def", "Ghi", "Jkl", "Mno", NA),
  V2 = c(1, 8, 3, 12, 4, NA),
  C1 = c(TRUE, TRUE, FALSE, FALSE, FALSE, TRUE),
  C2 = c("No", "No", "Yes", "Yes", "No", "No"),
  V3a = c(13.4, 11.8, 4.60, 3.50, -4.03, 0.78),
  V3b = c("Msk", NA, NA, "SPb", "Ekb", "Nsk")
  ) -> d

# dir.create("../data/r-tidy")
# file.remove(dir("data/r-tidy/", full.names = TRUE))

# d %>% write_csv("data/r-tidy/ds_csv.csv")
# d %>% write_csv2("data/r-tidy/ds_csv2.csv")
# d %>% write_tsv("data/r-tidy/ds_tsv.tsv")
# d %>% write_delim("data/r-tidy/ds_table.tsv", delim = " ")
# d %>% write.table("data/r-tidy/ds_delim.txt", sep = "|", dec = ",")
```

```{r read-csv}
ds <- read_csv("data/r-tidy/ds_csv.csv")
str(ds)
```

```{r read-csv2}
ds_csv2 <- read_csv2("data/r-tidy/ds_csv2.csv")
str(ds_csv2)
```

```{r read-tsv}
ds_tsv <- read_tsv("data/r-tidy/ds_tsv.tsv")
str(ds_tsv)
```

```{r read-table}
ds_table <- read_table("data/r-tidy/ds_table.tsv")
str(ds_table)
```

```{r read-delim}
ds_delim <- read_delim("data/r-tidy/ds_delim.txt",
                       delim = "|",
                       locale = locale(decimal_mark = ","))
str(ds_delim)
```


### Переименование переменных {#r-tidy-rename}


### Фильтрация данных {#r-tidy-subset}

#### Фильтрация столбцов {#r-tidy-select}

:::{#lst-select-basic}
```{r select-basic}
d %>% select(id, V1, V2, C1)
```
:::

:::{#lst-select-range}
```{r select-range}
d %>% select(id, V1:C2)
```
:::

:::{#lst-select-starts-with}
```{r select-starts-with}
d %>% select(starts_with("V"))
```
:::

:::{#lst-select-ends-with}
```{r select-ends-with}
d %>% select(ends_with("2"))
```
:::

:::{#lst-select-matches-basic}
```{r select-ends-matches-basic}
d %>% select(matches("V3"))
```
:::

:::{#lst-select-matches-regex}
```{r select-ends-matches-regex}
d %>% select(matches("V2|3"))
```
:::




#### Фильтрация строк {#r-tidy-filter-slice}

:::{#lst-filter-onecond}
```{r filter-onecond}
d %>% filter(C2 == "Yes")
```
:::

:::{#lst-filter-twoconds-and}
```{r filter-twoconds-and}
d %>% filter(C2 == "No" & V2 > 2)
```
:::

:::{#lst-filter-twoconds-or}
```{r filter-twoconds-or}
d %>% filter(C2 == "Yes" | V2 > 2)
```
:::

:::{#lst-filter-logvar}
```{r filter-logvar}
d %>% filter(C1)
```
:::

:::{#lst-filter-logvar-comb}
```{r filter-logvar-comb}
d %>% filter(!C1 & C2 == "Yes")
```
:::


:::{#lst-filter-strfuns}
```{r filter-strfuns}
d %>% filter(str_detect(V3b, "sk$"))
```
:::



### Сортировка данных {#r-tidy-arrange}

### Создание и изменение переменных {#r-tidy-mutate}

### Агрегация данных {#r-tidy-summarise}

### Объединение датасетов {#r-tidy-merge}

#### Объединение по строкам и столбцам {#r-tidy-binds}

#### Объединение по ключу {#r-tidy-joins}

##### `inner_join()`

##### `left_join()`

##### `right_join()`

##### `full_join()`

##### `semi_join()`

##### `anti_join()`


## Экспорт данных {#r-tidy-export}



***

###### Session Info {#session_info .unnumbered}

```{r session-info}
sessionInfo()
```

```{=html}
<script type="text/javascript" src="./js/chapter.js"></script>
```
